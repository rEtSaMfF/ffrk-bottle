{% extends "base.html" %}

{% block title %}Character Comparison{% endblock title %}

{% block extra_head %}<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.7.0/bootstrap-table.min.css">{% endblock extra_head %}

{% block extra_body %}<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.7.0/bootstrap-table.min.js"></script>
{# Only the last table will have keyevents
<script src="{{ url('static', filepath='js/bootstrap-table-keyevents.min.js') }}"></script>
#}
<script src="{{ url('static', filepath='js/bootstrap-table-mobile.min.js') }}"></script>{% endblock extra_body %}


{% block extra_javascript %}var data;
  $(document).ready(function () {
    $.getJSON("{{ data_url }}", function (d) {
      data = d;
      for (var i = 0; i < data.length; i++) {
        for (var j = 0; j < data[i]['Equipment'].length; j++)
          $.extend(data[i], data[i]['Equipment'][j]);
        for (var j = 0; j < data[i]['Abilities'].length; j++)
          $.extend(data[i], data[i]['Abilities'][j]);
        if (data[i]['job_name'] == data[i]['name'])
          // Add a space just to make the value unique :(
          data[i]['job_name'] += ' ';
      }
      $("#{{ o.main_tabs[0]['id'] }}-table").bootstrapTable("load", {data: data});
    });
    {% for tab in o.main_tabs %}
    $("#main-tabs a[href='#{{ tab['id'] }}']").on("shown.bs.tab", function (e) {
      $("#{{ tab['id'] }}-table").bootstrapTable("load", {data: data});
    });
    $("#{{ tab['id'] }}-table").on("load-success.bs.table", function () {
      $('#getError').hide();
      $('[data-toggle="tooltip"]').tooltip();
      $('[data-toggle="popover"]').popover();
    });
    $("#{{ tab['id'] }}-table").on("load-error.bs.table", function () {
      $("#getError").show()
    });
    {% endfor %}
  });{% endblock extra_javascript %}

{% block content %}
<div role="tabpanel" class="container-fluid">
  <ul id="main-tabs" class="nav nav-tabs" role="tablist">
    {% for tab in o.main_tabs %}
    {% if loop.first %}
    <li role="presentation" class="active">
    {% else %}
    <li role="presentation">
    {% endif %}
      <a href="#{{ tab['id'] }}" aria-controls="{{ tab['id'] }}" role="tab" data-toggle="tab" class="captalize">{{ tab['title'] }}</a>
    </li>
    {% endfor %}
  </ul> <!-- /#main-tabs /.nav /.nav-tabs -->

  <!-- Tab panes -->
  <div class="tab-content">
    {% for tab in o.main_tabs %}
    {% if loop.first %}
    <div role="tabpanel" class="tab-pane active" id="{{ tab['id'] }}">
    {% else %}
    <div role="tabpanel" class="tab-pane" id="{{ tab['id'] }}">
    {% endif %}
      <table
        id="{{ tab['id'] }}-table"
        class="table-condensed table-striped"
        data-toggle="table"
        data-cache="true"
        data-show-columns="true"
        data-pagination="true"
        data-page-size="256"
        data-page-list="[10, 25, 50, 100, All]"
        data-show-toggle="true"
        data-search="true"
        data-key-events="true"
        data-mobile-responsive="true"
        data-check-on-init="true"
        data-min-width="640"
      >
        <thead>
          <tr>
            <th data-width="25" data-formatter="inspect_formatter"></th>
            {% for c in tab['columns'] %}
            <th data-field="{{ c[0] }}" data-sortable="true" data-formatter="super_formatter">{{ c[1] }}</th>
            {% endfor %}
          </tr>
        </thead>
      </table>
    </div> <!-- /#{{ tab['id'] }} -->
    {% endfor %}
  </div>
</div> <!-- /.container-fluid -->
{% endblock content %}
